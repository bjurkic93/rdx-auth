<section class="card">
  <div class="card__header">
    <h1>Verify your email &amp; create a password</h1>
    <p>Enter the code we sent to your inbox, then choose a password to finish setting up your account.</p>
  </div>

  <div class="alert alert--success" *ngIf="successMessage">
    {{ successMessage }}
  </div>
  <div class="alert alert--success alert--muted" *ngIf="resendMessage">
    {{ resendMessage }}
  </div>
  <div class="alert alert--error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <form [formGroup]="verificationForm" (ngSubmit)="onSubmit()" novalidate class="form">
    <label class="field">
      <span class="field__label">Email</span>
      <input
        type="email"
        formControlName="email"
        placeholder="you@example.com"
        autocomplete="email"
        [class.invalid]="verificationForm.controls.email.touched && verificationForm.controls.email.invalid"
      />
      <span class="field__hint" *ngIf="verificationForm.controls.email.touched && verificationForm.controls.email.hasError('required')">
        Email is required.
      </span>
      <span class="field__hint" *ngIf="verificationForm.controls.email.touched && verificationForm.controls.email.hasError('email')">
        Enter a valid email address.
      </span>
    </label>

    <label class="field">
      <span class="field__label">Verification code</span>
      <input
        type="text"
        formControlName="verificationCode"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="123456"
        [class.invalid]="verificationForm.controls.verificationCode.touched && verificationForm.controls.verificationCode.invalid"
      />
      <span class="field__hint" *ngIf="verificationForm.controls.verificationCode.touched && verificationForm.controls.verificationCode.hasError('required')">
        Verification code is required.
      </span>
      <span class="field__hint" *ngIf="verificationForm.controls.verificationCode.touched && verificationForm.controls.verificationCode.hasError('pattern')">
        Enter the digits from your email (4&ndash;8 numbers).
      </span>
    </label>

    <label class="field">
      <span class="field__label">Password</span>
      <input
        type="password"
        formControlName="password"
        placeholder="••••••••"
        autocomplete="new-password"
        [class.invalid]="verificationForm.controls.password.touched && verificationForm.controls.password.invalid"
      />
      <span class="field__hint" *ngIf="verificationForm.controls.password.touched && verificationForm.controls.password.hasError('required')">
        Password is required.
      </span>
      <span class="field__hint" *ngIf="verificationForm.controls.password.touched && verificationForm.controls.password.hasError('minlength')">
        Password must be at least 8 characters.
      </span>
    </label>

    <label class="field">
      <span class="field__label">Confirm password</span>
      <input
        type="password"
        formControlName="confirmPassword"
        placeholder="••••••••"
        autocomplete="new-password"
        [class.invalid]="(verificationForm.controls.confirmPassword.touched && verificationForm.controls.confirmPassword.invalid) || passwordsMismatch"
      />
      <span class="field__hint" *ngIf="verificationForm.controls.confirmPassword.touched && verificationForm.controls.confirmPassword.hasError('required')">
        Please confirm your password.
      </span>
      <span class="field__hint" *ngIf="passwordsMismatch">
        Passwords must match.
      </span>
    </label>

    <div class="actions">
      <button type="submit" class="button" [disabled]="verificationForm.invalid || passwordsMismatch || isSubmitting">
        {{ isSubmitting ? 'Creating password...' : 'Create password' }}
      </button>
      <button type="button" class="button button--ghost" (click)="resendCode()" [disabled]="isResending">
        {{ isResending ? 'Sending...' : 'Resend code' }}
      </button>
    </div>
  </form>
</section>
